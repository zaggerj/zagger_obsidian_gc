---
alias:
tags: é•¿é’ç¬”è®°
cdate: 2023-12-27 11:23
uid: 20231227112448
searchterm: "#é•¿é’ç¬”è®°"
banner: "040 - Obsidian/é™„ä»¶/banners/book-banner.gif"
cssclass: noyaml
banner_icon: ğŸ’Œ
banner_x: 0.5
banner_y: 0.38
---

# 1. chromeæ‰©å±•å¼€å‘ç›¸å…³

## 1.1. Metadata

Status:: #ç¬”è®°çŠ¶æ€/ğŸŒ± å‘èŠ½
Source Type:: #ğŸ“¥/ğŸ’­ æƒ³æ³• 
Note Type:: #ç¬”è®°
Topic:: [[00.å­¦ä¹ -å‰ç«¯]]
Author:: zagger
Source URL::
Modify:: 2023-12-27 æ˜ŸæœŸä¸‰ 11:23:32

## 1.2. é•¿é’ç¬”è®°

_ä¸€å¥è¯æ¦‚æ‹¬è¿™ç¯‡ç¬”è®°çš„å†…å®¹_
Summary::

## 1.3. è‡ªæˆ‘é‡è¿°

_ç”¨è‡ªå·±çš„è¯å»é‡è¿°æå–çš„é‡ç‚¹å†…å®¹_

1. é—®é¢˜ï¼šã€æ’ä»¶ã€‘è·Ÿã€å®¢æˆ·ç«¯flashæœåŠ¡ã€‘å¦‚ä½•äº¤äº’ï¼Ÿ
```
ç¬¬ä¸€æ­¥ï¼šæ’ä»¶  <----ç»ˆç«¯ip---      guesttool
ç¬¬äºŒéƒ¨ï¼šç»ˆç«¯  <---http://ip:9999/*--->   æ’ä»¶
æ’ä»¶æ‹¿åˆ°ç»ˆç«¯IPåï¼Œå°±ç›´æ¥å’Œç»ˆç«¯å¯¹æ¥äº†
```
2. é—®ï¼šæœ‰æ²¡æœ‰å¯èƒ½ç”¨å…¶ä»–chromeå†…æ ¸çš„æµè§ˆå™¨ æ›¿æ¢nwï¼Ÿç­”ï¼šé‡å®šå‘ç¯å¢ƒè¦çš„æ˜¯ webviewï¼Œä¸æ˜¯é™„åŠ äº†å…¶å®ƒç•Œé¢å…ƒç´ çš„æµè§ˆå™¨
3. é—®ï¼šæˆ‘è¿™è¾¹åº”è¯¥æ˜¯ä¸ä¾èµ–nwçš„ï¼Œå¦‚æœè¦æ›¿æ¢ä¹Ÿæ˜¯ä»–ä»¬ç»ˆç«¯æœåŠ¡è¿™è¾¹è¦ä¿®æ”¹ä¸œè¥¿çš„ï¼Ÿç­”ï¼šæ˜¯

[[Service Worker API]]


## 1.4. é‡ç‚¹æ‘˜æŠ„

_æ‘˜æŠ„éƒ¨åˆ†åŸæ–‡åï¼Œè¿›è¡Œç­›é€‰åŠ ç²—ç„¶åå¯¹åŠ ç²—çš„ç»§ç»­è¿›è¡Œç­›é€‰è§å…‰ç¬”é€‰å‡ºã€‚_

### 1.4.1. ä½¿ç”¨åˆ°çš„APIç®€è¿°
1. Manifestï¼š[æ¸…å•æ–‡ä»¶æ ¼å¼ Â |Â  Manifest Â |Â  Chrome for Developers](https://developer.chrome.com/docs/extensions/reference/manifest?hl=zh-cn#keys)
	1. `"options_page"`ï¼šæŒ‡å®š options.html æ–‡ä»¶çš„è·¯å¾„ï¼Œä»¥å°†æ‰©å±•ç¨‹åºç”¨ä½œé€‰é¡¹é¡µé¢ã€‚å¦‚éœ€äº†è§£è¯¦æƒ…ï¼Œè¯·å‚é˜…[ä¸ºç”¨æˆ·æä¾›é€‰é¡¹](https://developer.chrome.com/docs/extensions/develop/ui/options-page?hl=zh-cn)ã€‚
	2. ä¸ºç”¨æˆ·æä¾›é€‰é¡¹ï¼š[ä¸ºç”¨æˆ·æä¾›é€‰é¡¹ Â |Â  Extensions Â |Â  Chrome for Developers](https://developer.chrome.com/docs/extensions/develop/ui/options-page?hl=zh-cn)
2. å†…å®¹è„šæœ¬ï¼š[å†…å®¹è„šæœ¬ Â |Â  Extensions Â |Â  Chrome for Developers](https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts?hl=zh-cn)
	1. chrome.runtimeï¼Œä½¿ç”¨Â `chrome.runtime`Â API å¯æ£€ç´¢ Service Workerï¼Œè¿”å›æœ‰å…³æ¸…å•çš„è¯¦æƒ…ï¼Œå¹¶ç›‘å¬å’Œå“åº”åº”ç”¨æˆ–æ‰©å±•ç¨‹åºç”Ÿå‘½å‘¨æœŸä¸­çš„äº‹ä»¶ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ­¤ API å°†ç½‘å€çš„ç›¸å¯¹è·¯å¾„è½¬æ¢ä¸ºå®Œå…¨é™å®šç½‘å€ã€‚Runtime API æä¾›äº†ä¸ºæ‰©å±•ç¨‹åºå¯ä»¥ä½¿ç”¨çš„åŠŸèƒ½çš„å¤šä¸ªé¢†åŸŸæä¾›æ”¯æŒçš„æ–¹æ³•ï¼š [chrome.runtime Â |Â  API Â |Â  Chrome for Developers](https://developer.chrome.com/docs/extensions/reference/api/runtime?hl=zh-cn#method-connect)
		1. onMessageäº‹ä»¶ï¼Œåœ¨æ‰©å±•ç¨‹åºè¿›ç¨‹ï¼ˆé€šè¿‡Â [`runtime.sendMessage`](https://developer.chrome.com/docs/extensions/reference/api/runtime?hl=zh-cn#method-sendMessage)ï¼‰æˆ–å†…å®¹è„šæœ¬ï¼ˆé€šè¿‡Â [`tabs.sendMessage`](https://developer.chrome.com/docs/extensions/reference/tabs/?hl=zh-cn#method-sendMessage)ï¼‰å‘é€æ¶ˆæ¯æ—¶è§¦å‘ã€‚ï¼š[chrome.runtime Â |Â  API Â |Â  Chrome for Developers](https://developer.chrome.com/docs/extensions/reference/api/runtime?hl=zh-cn#event-onMessage)
	2. chrome.tabsï¼Œä½¿ç”¨Â `chrome.tabs`Â API ä¸æµè§ˆå™¨çš„æ ‡ç­¾é¡µç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ­¤ API åœ¨æµè§ˆå™¨ä¸­åˆ›å»ºã€ä¿®æ”¹å’Œé‡æ–°æ’åˆ—æ ‡ç­¾é¡µã€‚Tabs API ä¸ä»…æä¾›æ“æ§å’Œç®¡ç†æ ‡ç­¾é¡µçš„åŠŸèƒ½ï¼Œè¿˜èƒ½æ£€æµ‹æ ‡ç­¾é¡µçš„[è¯­è¨€](https://developer.chrome.com/docs/extensions/reference/api/tabs?hl=zh-cn#method-detectLanguage)ã€æˆªå–[å±å¹•æˆªå›¾](https://developer.chrome.com/docs/extensions/reference/api/tabs?hl=zh-cn#method-captureVisibleTab)ï¼Œä»¥åŠä¸æ ‡ç­¾é¡µçš„å†…å®¹è„šæœ¬[é€šä¿¡](https://developer.chrome.com/docs/extensions/reference/api/tabs?hl=zh-cn#method-sendMessage)ã€‚
		1. äº‹ä»¶ï¼š[chrome.tabs Â |Â  API Â |Â  Chrome for Developers](https://developer.chrome.com/docs/extensions/reference/api/tabs?hl=zh-cn#event)
			1. onActivatedï¼šåœ¨çª—å£ä¸­çš„æ´»åŠ¨æ ‡ç­¾é¡µå‘ç”Ÿå˜åŒ–æ—¶è§¦å‘ã€‚è¯·æ³¨æ„ï¼Œåœ¨è§¦å‘æ­¤äº‹ä»¶æ—¶å¯èƒ½æœªè®¾ç½®æ ‡ç­¾é¡µçš„ç½‘å€ï¼Œä½†æ‚¨å¯ä»¥ç›‘å¬ onUpdated äº‹ä»¶ï¼Œä»¥ä¾¿åœ¨è®¾ç½®ç½‘å€æ—¶æ”¶åˆ°é€šçŸ¥ã€‚
			2. onUpdatedï¼šåœ¨æ ‡ç­¾é¡µæ›´æ–°æ—¶è§¦å‘ã€‚
			3. onRemovedï¼šåœ¨æ ‡ç­¾é¡µå…³é—­æ—¶è§¦å‘ã€‚
		2. executeScriptï¼šå°† JavaScript ä»£ç æ³¨å…¥ç½‘é¡µä¸­ã€‚å¦‚éœ€äº†è§£è¯¦æƒ…ï¼Œè¯·å‚é˜…å†…å®¹è„šæœ¬æ–‡æ¡£çš„[ç¨‹åºåŒ–æ³¨å…¥](https://developer.chrome.com/docs/extensions/content_scripts?hl=zh-cn#pi)[chrome.tabs Â |Â  API Â |Â  Chrome for Developers](https://developer.chrome.com/docs/extensions/reference/api/tabs?hl=zh-cn#method-executeScript)
		3. æ ‡ç­¾é¡µä¸Šçš„å±æ€§å’Œæ–¹æ³•ï¼š[chrome.tabs Â |Â  API Â |Â  Chrome for Developers](https://developer.chrome.com/docs/extensions/reference/api/tabs?hl=zh-cn#type-Tab)
		4. windowä¸Šçš„å±æ€§å’Œæ–¹æ³•ï¼š [chrome.windows Â |Â  API Â |Â  Chrome for Developers](https://developer.chrome.com/docs/extensions/reference/api/windows?hl=zh-cn#type-Window)
	3. webRequestï¼šä½¿ç”¨Â `chrome.webRequest`Â API å¯ä»¥è§‚å¯Ÿå’Œåˆ†ææµé‡ï¼Œä»¥åŠæ‹¦æˆªã€å±è”½æˆ–ä¿®æ”¹ä¼ è¾“ä¸­çš„è¯·æ±‚ã€‚
		1. onBeforeSendHeadersï¼šåœ¨è¯·æ±‚æ ‡å¤´å¯ç”¨æ—¶ï¼Œåœ¨å‘é€ HTTP è¯·æ±‚ä¹‹å‰è§¦å‘ã€‚è¿™å¯èƒ½ä¼šå‘ç”Ÿåœ¨ TCP è¿æ¥åˆ°æœåŠ¡å™¨ä¹‹åã€å‘é€ä»»ä½• HTTP æ•°æ®ä¹‹å‰ã€‚[chrome.webRequest Â |Â  API Â |Â  Chrome for Developers](https://developer.chrome.com/docs/extensions/reference/api/webRequest?hl=zh-cn#event-onBeforeSendHeaders)

### 1.4.2. ä»£ç é€»è¾‘ç®€è¿°

#### 1.4.2.1. èƒŒæ™¯é¡µé¢

èƒŒæ™¯é¡µé¢çš„æ¦‚å¿µå‚è€ƒ[ç™¾åº¦æ–‡æ¡£Â (opens new window)](https://chajian.baidu.com/developer/extensions/overview.html#arch)ã€‚

èƒŒæ™¯é¡µé¢æ˜¯å¸¸é©»å†…å­˜çš„ï¼Œå®ƒéœ€è¦ä¸ºç™½åå•ç½‘å€æä¾›é‡å®šå‘å¹¶ä¿å­˜å½“å‰é‡å®šå‘ä¿¡æ¯ã€‚

æ‰€æœ‰çš„é‡å®šå‘é€»è¾‘éƒ½åœ¨Â `src/js/core.js`Â é‡Œé¢ï¼Œå®ƒåšäº†è¿™æ ·å‡ ä»¶äº‹ï¼š

- ç›‘å¬æ¥è‡ªé¡µé¢çš„Â `viewport-change`Â äº‹ä»¶ï¼Œå¹¶å‘é€ç»™å®¢æˆ·ç«¯ flash æœåŠ¡
- é˜»æ­¢ç™½åå•ç½‘ç«™çš„ .swf æ–‡ä»¶è¯·æ±‚ï¼Œè¿™æ ·æ˜¯ä¸ºäº†ç¦ç”¨ flash æ’­æ”¾å™¨
- ç›‘å¬æµè§ˆå™¨æ¿€æ´» tab é¡µå˜åŒ–äº‹ä»¶
- ç›‘å¬æµè§ˆå™¨ tab é¡µæ›´æ–°äº‹ä»¶
- ç›‘å¬æµè§ˆå™¨ tab é¡µå…³é—­äº‹ä»¶

é‡å®šå‘çš„æ ¸å¿ƒé€»è¾‘å°±åœ¨ tab é¡µçš„ 3 ä¸ªäº‹ä»¶é‡Œé¢ï¼Œæ€»çš„æ¥è¯´å°±è¿™ä¹ˆå‡ æ¡ï¼š

1. æ‰“å¼€çš„æ—¶å€™å¼€å§‹æ’­æ”¾
2. å…³é—­çš„æ—¶å€™åœæ­¢æ’­æ”¾
3. åˆ‡æ¢ tab é¡µçš„æ—¶å€™ï¼Œå‰ä¸€ä¸ª tab é¡µä¸´æ—¶åœæ­¢æ’­æ”¾ï¼Œå½“å‰ tab é¡µå¼€å§‹æ’­æ”¾

å½“ä¸€ä¸ª tab é¡µåœ¨ç™½åå•é‡Œé¢æ—¶ï¼Œå°±ä¼šå¼€å§‹æ’­æ”¾ï¼Œæ’­æ”¾æ—¶æ’ä»¶ä¼šå°†Â `src/js/cs.js`Â æ³¨å…¥åˆ°å½“å‰ tab é¡µï¼Œæ³¨å…¥çš„ç›®çš„æ˜¯ä¸ºäº†æ•è·æµè§ˆå™¨çª—å£ç§»åŠ¨æˆ–è€…ç¼©æ”¾ã€‚


#### 1.4.2.2. å‰æ™¯é¡µé¢

æ­¤é¡µé¢å³Â `src/js/cs.js`ã€‚

å½“å®ƒå‡ºäºæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œå®ƒåšäº†è¿™ä¹ˆå‡ ä»¶äº‹æƒ…ï¼š

- æ¯éš” 1 ç§’ç›‘å¬ä¸€æ¬¡æµè§ˆå™¨çª—å£ä½ç½®æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚æœå˜åŒ–åˆ™å‘é€ç»™èƒŒæ™¯é¡µé¢
- ç›‘å¬æµè§ˆå™¨çª—å£ç¼©æ”¾äº‹ä»¶ï¼Œç¼©æ”¾æ—¶å‘é€æ¶ˆæ¯ç»™èƒŒæ™¯é¡µé¢
- ç›‘å¬æµè§ˆå™¨é¡µé¢å¯è§æ€§äº‹ä»¶ï¼Œå˜åŒ–æ—¶å‘é€æ¶ˆæ¯ç»™èƒŒæ™¯é¡µé¢ï¼Œä¸´æ—¶åœæ­¢æ­¤ tab é¡µçš„æ’­æ”¾



#### 1.4.2.3. flash é‡å®šå‘

flash é‡å®šå‘æ˜¯ä¸ºäº†é™ä½è™šæ‹Ÿæœºå†…æ’­æ”¾è§†é¢‘å¯¹VDIæœåŠ¡å™¨äº§ç”Ÿçš„CPUå‹åŠ›ã€‚

##### 1.4.2.3.1. [#](http://192.168.0.161/fedoc/flashredirect/#%E8%83%8C%E6%99%AF%E5%8E%9F%E7%90%86)èƒŒæ™¯åŸç†

VDIå®¢æˆ·ç«¯ä½¿ç”¨ spice åè®®è¿æ¥ç®¡ç†å°é‡Œé¢çš„æ•™å­¦åœºæ™¯æ—¶ï¼Œå®é™…ä¸Šç›¸å½“äºè¿æ¥äº†ä¸€ä¸ªç”±VDIæœåŠ¡å™¨åˆ›å»ºå‡ºæ¥çš„è™šæ‹Ÿæœºï¼ˆç±»ä¼¼è¿œç¨‹æ¡Œé¢è¿æ¥ï¼‰ï¼Œæ­¤æ—¶VDIå®¢æˆ·ç«¯ä¸Šé¢æœ‰å¦‚ä¸‹çª—å£ç•Œé¢ï¼š

- å®¢æˆ·ç«¯æ“ä½œç³»ç»Ÿç•Œé¢
- spice è¿œç¨‹è¿æ¥ç•Œé¢ï¼Œç•Œé¢é‡Œé¢å°±æ˜¯è™šæ‹Ÿæœºå†…çš„æ“ä½œç³»ç»Ÿç•Œé¢ï¼ˆä¸€èˆ¬æ˜¯å…¨å±ï¼Œå¯èƒ½æœªç½®é¡¶ï¼‰

å¯¹ç”¨æˆ·æ¥è¯´ï¼Œæ­¤æ—¶ä¸»è¦çš„äº¤äº’ç•Œé¢å°±æ˜¯ spice è¿œç¨‹è¿æ¥ç•Œé¢ï¼Œä¹Ÿå°±æ˜¯è™šæ‹Ÿæœºæ“ä½œç³»ç»Ÿç•Œé¢ã€‚ç”¨æˆ·åœ¨è™šæ‹Ÿæœºé‡Œé¢ä½¿ç”¨ Chrome æ‰“å¼€ä¼˜é…·ç½‘æ—¶ï¼Œä¼˜é…·å¯ä»¥æ’­æ”¾è§†é¢‘ï¼Œä½†ç”±äºè§†é¢‘æ¶‰åŠæ•°æ®åŠ è½½ã€è§£ç ã€æ’­æ”¾ç­‰ï¼Œè™šæ‹Ÿæœºå†…çš„CPUå‹åŠ›è¾ƒé«˜ï¼Œå½“æœ‰å¾ˆå¤šä¸ªè™šæ‹ŸæœºåŒæ—¶æ’­æ”¾è§†é¢‘æ—¶ï¼Œååº”åœ¨VDIæœåŠ¡å™¨ä¸Šå°±æ˜¯ç³»ç»Ÿè´Ÿè½½è¿‡é«˜ã€‚

ä¸ºäº†é™ä½VDIæœåŠ¡å™¨çš„ç³»ç»Ÿè´Ÿè½½ï¼Œflash é‡å®šå‘æŠ€æœ¯åº”è¿è€Œç”Ÿï¼Œè¿™é¡¹æŠ€æœ¯çš„æ ¸å¿ƒåŸç†æ˜¯è½¬ç§»è™šæ‹Ÿæœºå†…çš„CPUå‹åŠ›åˆ°å®¢æˆ·ç«¯ï¼Œå³ï¼šæ¯å½“è™šæ‹Ÿæœºé‡Œé¢è¦æ’­æ”¾è§†é¢‘çš„æ—¶å€™ï¼Œå°†æ’­æ”¾é‡å®šå‘åˆ°å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶è™šæ‹Ÿæœºå°±ä¸ç”¨æ’­æ”¾è§†é¢‘äº†ï¼Œè¿›è€Œæœ‰æ•ˆé™ä½è™šæ‹Ÿæœºå†…çš„CPUå‹åŠ›ã€‚

ä½¿ç”¨äº† flash é‡å®šå‘åï¼Œå½“VDIå®¢æˆ·ç«¯è¿æ¥è™šæ‹Ÿæœºæ—¶ï¼ŒVDIå®¢æˆ·ç«¯ä¸Šé¢æœ‰å¦‚ä¸‹çª—å£ç•Œé¢ï¼š

- å®¢æˆ·ç«¯æ“ä½œç³»ç»Ÿç•Œé¢
- spice è¿œç¨‹è¿æ¥ç•Œé¢ï¼Œç•Œé¢é‡Œé¢å°±æ˜¯è™šæ‹Ÿæœºå†…çš„æ“ä½œç³»ç»Ÿç•Œé¢ï¼ˆä¸€èˆ¬æ˜¯å…¨å±ï¼Œå¯èƒ½æœªç½®é¡¶ï¼‰
- flash è§†é¢‘æ’­æ”¾ç•Œé¢ï¼ˆæ­¤ç•Œé¢ä¸è™šæ‹Ÿæœºå†…çš„æ’­æ”¾ç•Œé¢**æ— ç¼é‡åˆ**ï¼‰

æ­¤æ—¶ï¼Œå¯¹äºç”¨æˆ·æ¥è¯´ï¼Œäº¤äº’è¿‡ç¨‹å¦‚åŒä»¥å‰ä¸€æ ·ï¼Œä»–å¹¶ä¸çŸ¥é“è§†é¢‘æ’­æ”¾å·²ç»è½¬ç§»åˆ°äº†å®¢æˆ·ç«¯ã€‚

##### 1.4.2.3.2. [#](http://192.168.0.161/fedoc/flashredirect/#%E9%87%8D%E5%AE%9A%E5%90%91%E7%B1%BB%E5%9E%8B)é‡å®šå‘ç±»å‹

é‡å®šå‘æœ‰ä¸¤ç§ï¼š

- ç¬¬ä¸€ç§æ˜¯ä½¿ç”¨è¯¸å¦‚æš´é£å½±éŸ³æ’­æ”¾è™šæ‹Ÿæœºå†…çš„è§†é¢‘æ—¶ï¼Œå®¢æˆ·ç«¯å¯åŠ¨äº†å¦ä¸€ä¸ªæ’­æ”¾ç¨‹åºåŒæ­¥æ’­æ”¾è™šæ‹Ÿæœºå†…çš„è§†é¢‘
- ç¬¬äºŒç§æ˜¯è®¿é—®æµè§ˆå™¨å†…çš„è§†é¢‘é¡µé¢çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯éœ€è¦å¦ä¸€ä¸ªæµè§ˆå™¨åŒæ­¥æµè§ˆè™šæ‹Ÿæœºå†…çš„æµè§ˆå™¨é¡µé¢

ç›®å‰å…¬å¸ç›¸å…³äº§å“çš„è®¾è®¡é‡Œï¼Œä»…ä»…ç¬¬äºŒç§ä¸å‰ç«¯æœ‰å…³ã€‚

ç–‘é—®ï¼šä¸ºä»€ä¹ˆåœ¨å®¢æˆ·ç«¯é‡Œé¢æ‰“å¼€æµè§ˆå™¨æ¥å®ç° flash é‡å®šå‘ï¼Ÿæ²¡æœ‰å…¶å®ƒæ›´å¥½çš„è§£å†³æ–¹æ¡ˆäº†å—ï¼Ÿ

çš„ç¡®æœ‰å…¶å®ƒæ›´å¥½çš„è§£å†³åŠæ³•ï¼Œä½†æ˜¯å…ˆè´¤ä»¬å·²ç»å€’åœ¨äº†ä»¥å‰çš„æ›´å¥½çš„æ–¹æ¡ˆé‡Œé¢ï¼Œ**é‡å®šå‘éœ€è¦è·å–åˆ°ç›®æ ‡è§†é¢‘çš„æœ‰æ•ˆåœ°å€ï¼Œå¯¹äºå¤šæ•°è§†é¢‘ç½‘ç«™æ¥è¯´ï¼ŒåŠ å¯†ã€è®¤è¯ã€è§†é¢‘åˆ†æ®µéƒ½æ˜¯å¸¸è§„æ‰‹æ®µï¼Œå®ƒä»¬ä¸ºä¼˜é›…çš„è§£å†³é‡å®šå‘æŠ€æœ¯æ ‘ç«‹äº†ç›¸å½“å¤§çš„éšœç¢**

##### 1.4.2.3.3. [#](http://192.168.0.161/fedoc/flashredirect/#flash-%E9%87%8D%E5%AE%9A%E5%90%91%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B)flash é‡å®šå‘å®ç°è¿‡ç¨‹

- è™šæ‹Ÿæœºå†…çš„ Chrome å®‰è£… flash é‡å®šå‘æ’ä»¶(ä¸‹é¢ç§°æ’ä»¶ï¼‰
- è™šæ‹Ÿæœºå†…çš„ Chrome æ‰“å¼€ä¼˜é…·ç½‘é¡µé¢
    - æ’ä»¶å‘é€å¼€å§‹æ’­æ”¾è¯·æ±‚åˆ°å®¢æˆ·ç«¯ flash é‡å®šå‘æœåŠ¡ï¼ˆä¸‹ç§°æœåŠ¡ï¼‰
    - æœåŠ¡å¯åŠ¨ nw
    - nw æ‰“å¼€ä¼˜é…·ç½‘ï¼Œå¹¶å®Œæ•´è¦†ç›–è™šæ‹Ÿæœºæµè§ˆå™¨è§†å£åŒºåŸŸ
    - ç”¨æˆ·è§‚çœ‹ nw æ’­æ”¾çš„è§†é¢‘
    - ç”¨æˆ·åœ¨ nw æ’­æ”¾çš„é¡µé¢ç‚¹å‡»å¦ä¸€ä¸ªè§†é¢‘
    - å¦ä¸€ä¸ªè§†é¢‘ç»§ç»­åœ¨ nw é‡Œé¢æ’­æ”¾
    - ç”¨æˆ·å…³é—­æ‰ä¼˜é…·ç½‘ tab é¡µ
    - æ’ä»¶å‘é€åœæ­¢æ’­æ”¾è¯·æ±‚åˆ°æœåŠ¡

##### 1.4.2.3.4. [#](http://192.168.0.161/fedoc/flashredirect/#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%AB%E5%81%9A-flash-%E9%87%8D%E5%AE%9A%E5%90%91)ä¸ºä»€ä¹ˆå«åš flash é‡å®šå‘ï¼Ÿ

è¯¥é¡¹ç›®æ—©æœŸé˜¶æ®µï¼Œflash è¿˜å¤§è¡Œå…¶é“ï¼Œå½“æ—¶è§£å†³é—®é¢˜çš„é¦–è¦é—®é¢˜å°±æ˜¯å¤„ç† flash è§†é¢‘ï¼Œå› æ­¤å‘½åä¸º flash é‡å®šå‘ï¼Œç°åœ¨å¯ä»¥ç§°ä¹‹ä¸º web é‡å®šå‘ã€‚
#### 1.4.2.4. # æ’ä»¶è¯´æ˜

æ’ä»¶ä»“åº“ï¼š[åœ°å€(opens new window)](http://172.16.203.254/zhangyao/newflashrediredt)

æŠ€æœ¯æ ˆï¼šgulp, commonjs, javascript, chrome.* API

è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ Chrome æµè§ˆå™¨æ’ä»¶ï¼ŒChrome æ’ä»¶å¼€å‘çš„å®˜æ–¹æ–‡æ¡£åœ¨[è¿™é‡Œ](http://192.168.0.161/fedoc/flashredirect/plugin.html)ï¼Œç™¾åº¦æä¾›äº†ä¸€ä¸ª[æ±‰åŒ–çš„æ–‡æ¡£Â (opens new window)](https://chajian.baidu.com/developer/extensions/getstarted.html)ï¼Œä¸è¿‡è¿™ä¸ªæ–‡æ¡£ä¸æ˜¯æœ€æ–°çš„ï¼Œå¹¶ä¸”æœ‰éƒ¨åˆ†APIä»…ä»…åœ¨ç™¾åº¦æµè§ˆå™¨ä¸Šå¯ä»¥ä½¿ç”¨ã€‚

##### 1.4.2.4.1. [#](http://192.168.0.161/fedoc/flashredirect/plugin.html#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84)ç›®å½•ç»“æ„

```
src
â”œâ”€â”€ css                        # é€‰é¡¹é¡µæ ·å¼
â”‚Â Â  â””â”€â”€ options.css
â”œâ”€â”€ images                     # logo
â”‚Â Â  â”œâ”€â”€ icon128.png
â”‚Â Â  â”œâ”€â”€ icon16.png
â”‚Â Â  â”œâ”€â”€ icon48.png
â”‚Â Â  â””â”€â”€ icon64.png
â”œâ”€â”€ js
â”‚Â Â  â”œâ”€â”€ ajax.js
â”‚Â Â  â”œâ”€â”€ background.js          # èƒŒæ™¯è„šæœ¬ä¸»ç¨‹åº
â”‚Â Â  â”œâ”€â”€ core.js                # æ ¸å¿ƒçš„ä¸šåŠ¡é€»è¾‘å®ç°
â”‚Â Â  â”œâ”€â”€ cs.js                  # å‰å°è„šæœ¬ï¼Œç”±èƒŒæ™¯è„šæœ¬æ‰‹åŠ¨æ³¨å…¥åˆ°è§†é¢‘æ’­æ”¾é¡µé¢
â”‚Â Â  â”œâ”€â”€ env
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ development.js
â”‚Â Â  â”‚Â Â  â””â”€â”€ production.js
â”‚Â Â  â”œâ”€â”€ livereload.js          # è‡ªåŠ¨é‡è½½æ’ä»¶çš„å¼€å‘å·¥å…·
â”‚Â Â  â”œâ”€â”€ old                    # å¿½ç•¥æ‰
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ README.md
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ background.js
â”‚Â Â  â”‚Â Â  â””â”€â”€ content_script.js
â”‚Â Â  â”œâ”€â”€ options.js             # é€‰é¡¹é¡µçš„ jsï¼Œä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹
â”‚Â Â  â”œâ”€â”€ service                # å°†å•ä¸€çš„åŠŸèƒ½ä»£ç å°è£…ä¸ºä¸€ä¸ªå¯æ‰§è¡Œçš„æœåŠ¡
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ changebase.js      # ä¿®æ”¹é‡å®šå‘æœåŠ¡åœ°å€çš„æœåŠ¡
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ device.js          # è·å–å®¢æˆ·ç«¯è®¾å¤‡ä¿¡æ¯çš„æœåŠ¡
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ heartbeat.js       # å¿ƒè·³æœåŠ¡
â”‚Â Â  â”‚Â Â  â””â”€â”€ playstatus.js      # è½®è®­å½“å‰æ’­æ”¾çŠ¶æ€çš„æœåŠ¡
â”‚Â Â  â”œâ”€â”€ util.js
â”‚Â Â  â”œâ”€â”€ variables.js
â”‚Â Â  â””â”€â”€ whitelist.js           # é»˜è®¤çš„ç™½åå•åˆ—è¡¨ï¼Œç”¨æˆ·å¢åˆ äº†ç™½åå•åï¼Œå¼•å…¥æ­¤æ¨¡å—åå°±æ˜¯ä¿®æ”¹åçš„ç™½åå•
â”œâ”€â”€ manifest.json              # æ’ä»¶å…ƒæ•°æ®
â””â”€â”€ options.html               # é€‰é¡¹é¡µï¼Œé‡Œé¢å¯ä»¥è®¾ç½®ç™½åå•
dist.pem                       # æ’ä»¶çš„ç§˜é’¥ï¼Œä¸å¯ä»¥ä¿®æ”¹
```

##### 1.4.2.4.2. [#](http://192.168.0.161/fedoc/flashredirect/plugin.html#%E5%8F%AF%E7%94%A8%E7%9A%84%E5%91%BD%E4%BB%A4)å¯ç”¨çš„å‘½ä»¤

##### 1.4.2.4.3. [#](http://192.168.0.161/fedoc/flashredirect/plugin.html#gulp-%E6%88%96%E8%80%85-gulp-watch)`gulp`Â æˆ–è€…Â `gulp watch`

è¿è¡Œä¸€æ¬¡ build ä»»åŠ¡ï¼Œå¹¶ç›‘å¬æºç å˜æ›´ï¼Œæ¯å½“å‘ç”Ÿå˜æ›´æ—¶ï¼Œé‡æ–°æ‰§è¡Œ build ä»»åŠ¡

##### 1.4.2.4.4. [#](http://192.168.0.161/fedoc/flashredirect/plugin.html#gulp-build)`gulp build`

ç”Ÿæˆä»£ç åˆ° dist ç›®å½•ï¼ŒåŒæ—¶ç”Ÿæˆ sourcemap åˆ° maps ç›®å½•ã€‚ç”Ÿæˆä¹‹åï¼Œéœ€è¦ä½¿ç”¨ Chrome æµè§ˆå™¨çš„æ’ä»¶ç®¡ç†é¡µé¢æ‰‹åŠ¨æ‰“åŒ…æœ¬æ‰©å±•ï¼Œå¦‚å›¾ï¼šÂ ![chrome build crx](http://192.168.0.161/fedoc/assets/img/build-crx.80bbadde.png)Â æ‰“åŒ…åä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ç”ŸæˆÂ `dist.crx`ï¼Œæ­¤æ—¶è¿è¡Œï¼š

```
bash deploy.sh
```

ä¸Šé¢çš„å‘½ä»¤ä¼šå°†Â `dist.crx`Â ç§»åŠ¨åˆ° zips ç›®å½•å¹¶åŠ ä¸Šæ—¥æœŸå’Œ build å·ä¿¡æ¯ã€‚

**æ³¨æ„ï¼šæäº¤çš„æ—¶å€™ï¼Œzips, maps ç›®å½•éƒ½éœ€è¦æäº¤**

##### 1.4.2.4.5. [#](http://192.168.0.161/fedoc/flashredirect/plugin.html#%E5%89%8D%E5%B0%98%E5%BE%80%E4%BA%8B)å‰å°˜å¾€äº‹

##### 1.4.2.4.6. [#](http://192.168.0.161/fedoc/flashredirect/plugin.html#deploy-sh-%E8%84%9A%E6%9C%AC%E9%87%8C%E9%9D%A2%E6%9C%89%E5%87%A0%E8%A1%8C%E4%BB%A3%E7%A0%81%E8%A2%AB%E6%B3%A8%E9%87%8A%E6%8E%89%E4%BA%86-%E4%B8%BA%E4%BB%80%E4%B9%88)deploy.sh è„šæœ¬é‡Œé¢æœ‰å‡ è¡Œä»£ç è¢«æ³¨é‡Šæ‰äº†ï¼Œä¸ºä»€ä¹ˆï¼Ÿ

è¿™å‡ è¡Œä»£ç å¦‚ä¸‹ï¼š

> ä¸‹é¢è¿™ç§è‡ªåŠ¨æ£€æŸ¥æ’ä»¶ ID çš„æ–¹æ³•åœ¨ chrome 65 å¤±æ•ˆäº†
> 
> echo "check extension id ..."
> 
> node -p "require('crx-parser')(fs.readFileSync('./dist.crx'), function(err, data){ console.log(err || (require('chrome-extension-id')(data.header.publicKey) === 'nallafmcbjlffmfjnndbjmfpnicjfbnp' ? 'match' : 'not match')); })"

æ‰“åŒ…æ‰©å±•çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨ç§˜é’¥æ–‡ä»¶ï¼Œä¸ºäº†æ–¹ä¾¿éªŒè¯æ‰“åŒ…åçš„ ID æ˜¯å¦ä¸€è‡´ï¼Œæ·»åŠ äº†ä¸Šè¿°ä»£ç æ ¡éªŒå½“å‰æ‰“åŒ…çš„æ‰©å±•æ˜¯å¦æ˜¯é»˜è®¤çš„ IDã€‚ä¸å¹¸çš„æ˜¯ï¼ŒChrome 65 ä¹‹åï¼Œè¿™ç§æ ¡éªŒæ–¹æ³•å¤±æ•ˆäº†ï¼Œä½¿ç”¨çš„ä¾èµ–åº“Â [chrome-extension-idÂ (opens new window)](https://npm.taobao.org/package/chrome-extension-id)ä¹Ÿæ²¡æœ‰ç»§ç»­æ›´æ–°ï¼Œæ‰€ä»¥æ³¨é‡Šæ‰äº†è¿™é‡Œçš„ä»£ç ï¼Œå¦‚æœä»¥åå‘ç°è¿™ä¸ªä¾èµ–åŒ…æ›´æ–°äº†ï¼Œå¯ä»¥æ”¾å¼€è¿™äº›æ³¨é‡Šã€‚

##### 1.4.2.4.7. [#](http://192.168.0.161/fedoc/flashredirect/plugin.html#dist-pem-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E8%83%BD%E4%BF%AE%E6%94%B9)dist.pem ä¸ºä»€ä¹ˆä¸èƒ½ä¿®æ”¹ï¼Ÿ

dist.pem ä¿è¯äº†æ¯æ¬¡æ‰“åŒ…çš„æ‰©å±•IDä¸å˜ã€‚

æ­£å¸¸æ¥è¯´ï¼Œç”±äºæ’ä»¶å¹¶æ²¡æœ‰ä¸Šä¼ åˆ° Chrome æ’ä»¶å•†åŸï¼Œç›´æ¥å®‰è£…æ˜¯æ— æ³•æˆåŠŸçš„ï¼Œä½†è™šæ‹Ÿæœºå†…çš„ guesttool ä¿®æ”¹äº†ç›¸å…³æ³¨å†Œè¡¨ï¼Œä½¿å¾—å¯ä»¥å®‰è£…æŒ‡å®šçš„æ’ä»¶ã€‚è¿™ä¸ªæŒ‡å®šçš„æ„æ€å°±æ˜¯æŒ‡å®šä¸€ç³»åˆ—å…è®¸çš„æ’ä»¶ IDï¼Œåœ¨è¿™ä¸ªåˆ—è¡¨é‡Œé¢çš„ ID å°±å¯ä»¥ç›´æ¥å®‰è£…ã€‚
# 2. ç›¸å…³æ–‡ç« 

_æ‘˜æŠ„æ¥æºï¼Œå¼•ç”¨å‡ºå¤„ï¼Œå‚è€ƒé“¾æ¥ï¼Œæ–‡æ¡£æŸ¥è¯¢_
Page Link::
1. Manifest V3ï¼š
[chrome.tabs Â |Â  API Â |Â  Chrome for Developers](https://developer.chrome.com/docs/extensions/reference/api/tabs?hl=zh-cn#method-executeScript)
[æ‰©å±•ç¨‹åº / ä½¿ç”¨å…¥é—¨ Â |Â  Get started Â |Â  Chrome for Developers](https://developer.chrome.com/docs/extensions/get-started?hl=zh-cn)
[Hello World æ‰©å±•ç¨‹åº Â |Â  Extensions Â |Â  Chrome for Developers](https://developer.chrome.com/docs/extensions/get-started/tutorial/hello-world?hl=zh-cn)
[æ‰©å±•ç¨‹åº Service Worker ç®€ä»‹ Â |Â  Extensions Â |Â  Chrome for Developers](https://developer.chrome.com/docs/extensions/develop/concepts/service-workers?hl=zh-cn)



2. Manifest V2ï¼š
[extensions/mv2/reference?hl=zh-cn](https://developer.chrome.com/docs/extensions/mv2/reference?hl=zh-cn)

3. [æ’ä»¶è¯´æ˜ | OS-Easy å‰ç«¯æ–‡æ¡£](http://192.168.0.161/fedoc/flashredirect/plugin.html)
[ServiceWorkerGlobalScope - Web API æ¥å£å‚è€ƒ | MDN](https://developer.mozilla.org/zh-CN/docs/Web/API/ServiceWorkerGlobalScope#events)