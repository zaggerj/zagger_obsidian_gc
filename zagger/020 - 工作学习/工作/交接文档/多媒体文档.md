---
title: 'å¤šåª’ä½“å¢è¡¥æ–‡æ¡£'
date: '2024-06-28T06:53:07.945Z'
tags: ['MMC', 'å­¦ä¹ ä»»åŠ¡']
created: '2024-01-05T07:40:46.446Z'
creator: 'æ—æ±‰é’'
type: 'text/x-markdown'
modifier: 'æ—æ±‰é’'
---

<!-- Exported from TiddlyWiki at 14:53, 28th å…­æœˆ 2024 -->

# å¤šåª’ä½“å¢è¡¥æ–‡æ¡£

# èƒŒæ™¯

å¤šåª’ä½“äº’åŠ¨æ•™å­¦è½¯ä»¶æ˜¯â¼€å¥—åˆ©ç”¨å¤šåª’ä½“è®¡ç®—æœºè¾…åŠ©æ•™å¸ˆå®Œæˆæ•™å­¦çš„è½¯ä»¶ï¼ˆç±»ä¼¼äºæåŸŸæ•™å®¤ç³»ç»Ÿï¼‰ã€‚æˆ‘ä»¬ç§°ä¸ºå™¢æ˜“å¤šåª’ä½“ç½‘ç»œæ•™å®¤è½¯ä»¶ï¼ˆä¿¡åˆ›ç‰ˆï¼‰ï¼ˆç®€ç§°ï¼šä¿¡åˆ› MMCï¼‰ã€‚ç°åœ¨å…¬å¸å·²æœ‰ windows ç«¯çš„å¤šåª’ä½“ï¼Œä½†ä¸ºäº†å¯åœ¨å›½äº§èŠ¯ç‰‡è®¾å¤‡å’Œå›½äº§æ“ä½œç³»ç»Ÿä¸ŠåŒæ ·é€‚é…ï¼Œåˆ™è¯ç”Ÿäº†ä¿¡åˆ›å¤šåª’ä½“ã€‚

# ä¸šåŠ¡æ¿å—

![](https://img-blog.csdnimg.cn/direct/ea310b4c336b43389c459c4b399d38d0.jpeg#pic_center)

## æ¡†æ¶

Electronâ€”â€”æ•™å¸ˆç«¯

> Electron æ˜¯ä¸€ä¸ªä½¿ç”¨ JavaScriptã€HTML å’Œ CSS æ„å»ºæ¡Œé¢åº”ç”¨ç¨‹åºçš„æ¡†æ¶ã€‚ åµŒå…¥ Chromium å’Œ Node.js åˆ° äºŒè¿›åˆ¶çš„ Electron å…è®¸æ‚¨ä¿æŒä¸€ä¸ª JavaScript ä»£ç ä»£ç åº“å¹¶åˆ›å»º åœ¨ Windows ä¸Šè¿è¡Œçš„è·¨å¹³å°åº”ç”¨ macOS å’Œ Linuxâ€”â€”ä¸éœ€è¦æœ¬åœ°å¼€å‘ ç»éªŒã€‚

ç»å…¸é¡¹ç›®ï¼švscodeï¼Œwindows for clash

QTâ€”â€”å­¦ç”Ÿç«¯ï¼ˆåœ¨ 2.1.0 ç‰ˆæœ¬åæ‰æ”¹ä¸º QT å®ç°ï¼Œåœ¨ 2.0.0 ç‰ˆæœ¬æ˜¯ç”±å‰ç«¯ electron å®ç°ï¼‰

> Qt æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ C++åº”ç”¨ç¨‹åºå¼€å‘æ¡†æ¶ã€‚å¹¿æ³›ç”¨äºå¼€å‘ GUI ç¨‹åºï¼Œè¿™ç§æƒ…å†µä¸‹åˆè¢«ç§°ä¸ºéƒ¨ä»¶å·¥å…·ç®±ã€‚ä¹Ÿå¯ç”¨äºå¼€å‘é GUI ç¨‹åºï¼Œä¾‹å¦‚æ§åˆ¶å°å·¥å…·å’ŒæœåŠ¡å™¨ã€‚
> 
> 
> GUIï¼šå›¾å½¢ç”¨æˆ·ç•Œé¢

ç»å…¸é¡¹ç›®ï¼šWPSï¼ŒYY è¯­éŸ³ï¼Œå’ªå’•éŸ³ä¹

## é€šè®¯æ–¹å¼

æ•™å¸ˆç«¯ä¸ server è¿›ç¨‹ç›¸äº’é€šè®¯ï¼Œå­¦ç”Ÿç«¯ä¸ client è¿›ç¨‹ç›¸äº’é€šè®¯ï¼Œserver è¿›ç¨‹ä¸ client è¿›ç¨‹ç›¸äº’é€šè®¯ã€‚

## å‰ç«¯é¡¹ç›®ç»„æˆï¼ˆ2.1.0ï¼‰

å‰ç«¯é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Lerna å®ç°çš„ Monorepo é¡¹ç›®ã€‚

* teacher-uiï¼šæ•™å¸ˆç«¯é¡µé¢

* setup-uiï¼šåˆå§‹åŒ–é…ç½®ç•Œé¢

* serverï¼šå‰ç«¯ä½¿ç”¨ nodejs å°è£…çš„æœåŠ¡ï¼Œå…¶ä¸­åŒ…æ‹¬ wsã€httpã€fs ç­‰ã€‚

* common-electronï¼šelectron çª—å£åˆå§‹åŒ–å…¥å£

![](https://img-blog.csdnimg.cn/direct/800b2a66f92a489686651173180ca158.jpeg#pic_center)

## æ•™å¸ˆç«¯é€šè®¯åŸºæœ¬æµç¨‹

å¯åŠ¨ï¼š

1. åç«¯è°ƒèµ·æ¥æˆ‘ä»¬çš„ common-electronï¼ˆè¿è¡Œ/common-electron/main.jsï¼‰ï¼Œå¯¹ electron è¿›ç¨‹åˆå§‹åŒ–

1. è°ƒç”¨ start.sh è¿è¡Œ server è¿›ç¨‹

1. è¿è¡Œå‰ç«¯ vue é¡¹ç›®

## æ¶ˆæ¯é€šçŸ¥ï¼š

åœ¨å¤šåª’ä½“çš„é¡¹ç›®ä¸­ï¼Œæ¶ˆæ¯åŸºæœ¬éƒ½æ˜¯å•å‘çš„ï¼ˆé™¤äº†å‰ç«¯è¯»å†™ server.jsonï¼Œå› ä¸ºè¯¥æ–¹æ³•æ˜¯é€šè¿‡ nodejs å‰ç«¯è‡ªå·±è¯»å–ï¼‰

## ui -> serverï¼ˆå‰ç«¯åˆ°åç«¯ï¼‰

### 1.vue ç«¯å‘é€ axios è¯·æ±‚ï¼ˆpostï¼‰ï¼Œurl æ ¼å¼ä¸ºï¼š/g/:type/:sub/:context?win=xï¼ˆä¸åç«¯æ¥å£æ–‡æ¡£åŒ¹é…ï¼‰

æ‰€æœ‰çš„é¡µé¢æ‰“å¼€æ—¶éƒ½ä¼šåŠ ä¸Š `win=x` æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°ï¼Œ`x` è¡¨ç¤ºå½“å‰æµè§ˆå™¨çª—å£çš„ id, æ˜¯ä¸ªæ•´æ•°ã€‚

è¯·æ±‚æ—¶å¿…é¡»åœ¨ body é‡Œé¢ä¼  json:

```json
{
"to": ["ip1", "ip2", "..."],['all']
"data": {}
}
```

å‚æ•°è¯´æ˜

| g       | URL   |                 | å‰ç«¯æ ‡è¯†ï¼Œåªæœ‰ç»™åç«¯å‘çš„æ¶ˆæ¯å¸¦æœ‰/gæ ‡è¯†                        |
|---------|-------|-----------------|---------------------------------------------|
| type    | URL   | String          | å¤šåª’ä½“åè®®æ¶ˆæ¯ç±»å‹ï¼Œå‚è€ƒå¤šåª’ä½“æ–‡æ¡£ï¼Œåè®®ç‰ˆæœ¬ä½¿ç”¨ `v` å‚æ•°             |
| sub     | URL   | String          | å¤šåª’ä½“åè®®æ¶ˆæ¯å­ç±»å‹ï¼Œå¦‚æœæ˜¯ null, ä¼  `null`               |
| context | URL   | String          | å¤šåª’ä½“åè®®æ¶ˆæ¯å¯¹è±¡åï¼Œå¦‚æœæ˜¯ null, ä¼  `null`               |
| v       | query | Number          | å¤šåª’ä½“åè®®æ¶ˆæ¯ç‰ˆæœ¬                                   |
| to      | body  | `Array<String>` | å¤šåª’ä½“æ¶ˆæ¯é‡Œé¢çš„ `id` å­—æ®µï¼Œå³åç«¯ä¼šè¦æ±‚éœ€è¦å°†æ•™å¸ˆç«¯çš„æ¶ˆæ¯å‘ç»™å…·ä½“çš„å“ªå‡ å°å­¦ç”Ÿæœº |
| data    | body  | Object          | å¤šåª’ä½“æ¶ˆæ¯å¯¹è±¡å„å­—æ®µå€¼ï¼Œå¿…é¡»ä½¿ç”¨å°é©¼å³°å‘½åæ³•                      |

### 2.express å¤„ç†è¯·æ±‚ï¼šå°† urlï¼Œä»¥åŠ post çš„ body è§£ææˆåç«¯è¦çš„ jsonï¼ˆcontextï¼šbase64 æ ¼å¼ï¼‰ï¼Œå¹¶è½¬æˆå­—ç¬¦ä¸²é€šè¿‡ ws å‘é€ç»™åç«¯

```js
router.post('/:type/:sub/:context', wsmw, function (req, res, next) {
  const version = req.query.v || 1
  const { type, sub, context } = req.params
  const { to, data } = req.body
  const contextstr = context === 'null' ? '' : encode(context, data)
  const json = {
	'type&name': type === 'common' ? type : `${type}:${version}`,
	sub: sub === 'null' ? null : sub,
	context: contextstr,
	id: global.config.isStudent ? '127.0.0.1' : to
  }
  req.send(json)
  res.json({ code: 0 })
})
```

## server -> uiï¼ˆåç«¯åˆ°å‰ç«¯ï¼‰

1. åç«¯é€šè¿‡ ws å‘é€æ¶ˆæ¯åˆ°å‰ç«¯

1. é€šè¿‡ä½¿ç”¨ ipcRenderer.send API å‘é€ä¸€ä¸ªåä¸ºâ€˜mmc-messageâ€™çš„æ¶ˆæ¯ï¼Œç„¶åä½¿ç”¨ ipcMain.on API æ¥æ”¶ã€‚

1. åœ¨æ”¶åˆ°â€˜mmc-messageâ€™çš„æ¶ˆæ¯åï¼Œä½¿ç”¨ despatchEvent é€šè¿‡ windows æ´¾å‘è‡ªå®šä¹‰äº‹ä»¶ã€‚

1. åœ¨æ‰€éœ€è¦çš„é¡µé¢ä½¿ç”¨ windows.addEventListener ç›‘å¬å¤„ç†

> ipcRenderer
> 
> 
> ä»æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹çš„å¼‚æ­¥é€šä¿¡ã€‚
> 
> 
> ipcMain
> 
> 
> ä»ä¸»è¿›ç¨‹åˆ°æ¸²æŸ“è¿›ç¨‹çš„å¼‚æ­¥é€šä¿¡ã€‚

### æ³¨æ„ï¼š

å‰åç«¯æ¶ˆæ¯è™½ç„¶æ˜¯é€šè¿‡ ws è¿›è¡Œä¼ è¾“ï¼Œä½†æ˜¯æ¶ˆæ¯å´æ˜¯æˆ‘ä»¬è¦ä»€ä¹ˆå†å»è¯·æ±‚ä»€ä¹ˆï¼Œä»–ä¸ä¼šä¸»åŠ¨å‘æˆ‘ä»¬æ¨é€ã€‚

ä¾‹å¦‚ï¼šä»¥ç¼©ç•¥å›¾äº¤äº’ä¸ºä¾‹ï¼ˆéœ€è¦å“ªå‡ å°çš„ç¼©ç•¥å›¾å°±å‘é€å“ªå‡ å°çš„ ip åœ°å€ï¼Œé€šè¿‡å‰ç«¯è½®è®­è¯·æ±‚ï¼‰

# å¼€å‘ç¯å¢ƒé…ç½®

1. ä»ä»“åº“å°†ä»£ç  clone

1. åœ¨æœ€å¤–å±‚ install

1. è¿›å…¥/packages/common-electronï¼Œæ–°å»º server.json æ–‡ä»¶ï¼Œæ–°å»º env.dev æ–‡ä»¶

env.dev

```
NODE_ENV=development // å¼€å‘ç¯å¢ƒ
TYPE=teacher // è¿è¡Œæ•™å¸ˆç«¯
IP=172.16.43.8 // æœ¬æœº ip
PORT=3333 // å ç”¨ç«¯å£
SETUP=ture // æ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œå³æ˜¯å¦è¿è¡Œ setup-ui
```

1. è¿›å…¥åˆ°/packages/teacher-uiï¼Œyarn serve è¿è¡Œæ•™å¸ˆç«¯ç•Œé¢

1. è¿›å…¥åˆ°/packages/common-electronï¼Œyarn serve è¿è¡Œ electron å£³å­

ï¼ˆè¿™é‡Œå¯ä»¥ä½¿ç”¨ wait-on æ¨¡å—æ¥ç­‰å¾… teacher-ui å ç”¨ç‰¹å®šç«¯å£ï¼Œç„¶åå†è¿è¡Œ common-electron çš„å¯åŠ¨å‘½ä»¤ï¼Œåªç”¨ä¸€æ¡å‘½ä»¤è¿è¡Œã€‚ä½†æ˜¯è¿™æ ·ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå‡å¦‚å‘½ä»¤ä¸º startï¼Œåˆ™è¿è¡Œäº† yarn start åï¼Œç­‰åˆ° common-electron è¿è¡Œå®Œåï¼Œè¯¥å‘½ä»¤æœ€åæ˜¾ç¤ºçš„åªä¼šæ˜¯ common-electrorn å ç”¨çš„åœ°å€ï¼Œå³ ctrl+c å–æ¶ˆè¿è¡Œä¹Ÿåªä¼šå–æ¶ˆ common-electronï¼Œä¸ä¼šå–æ¶ˆ teacher-ui çš„è¿è¡Œï¼Œè‹¥å†æ¬¡è¿è¡Œ startï¼Œåˆ™ä¼šå¤šæ¬¡è®© teacher-ui å ç”¨å¤šä¸ªç«¯å£ï¼‰

# æ•™å¸ˆç«¯ä¸šåŠ¡

ä»¥çª—ä½“åˆ†ï¼šåˆ†ä¸ºä¸»çª—ä½“ã€æ‚¬æµ®æ ã€å¼¹çª—

## ä¸»çª—ä½“

ä¸»çª—ä½“ï¼Œå³ç™»å½•ä»¥åŠä¸€äº›åŠŸèƒ½æŒ‰é’®å…¥å£ã€‚ä¸»çª—ä½“æ˜¯æœ‰ä¸¤ä¸ªè·¯ç”±ï¼Œåˆ†åˆ«ä¸º/loginã€/home

ç™»å½•é¡µå¯è¿›è¡Œæ“ä½œï¼šæ¿€æ´»ï¼ˆåœ¨çº¿ï¼Œç¦»çº¿ï¼‰

ä¸»é¡µé¢å¯è¿›è¡Œæ“ä½œï¼šå±å¹•å¹¿æ’­ã€å½±éŸ³å¹¿æ’­ã€å­¦ç”Ÿæ¼”ç¤ºã€é¥æ§è½¬æ’­ã€ä¸‹å‘ä½œä¸šã€æ”¶å–ä½œä¸šã€è¿œç¨‹å¼€æœºã€è¿œç¨‹å…³æœºã€è¾…åŠ©æ•™å­¦ï¼ˆé»‘å±è‚ƒé™ã€ç”µå­ç‚¹åã€ç”µå­ç™½æ¿ã€å±å¹•å½•åˆ¶ã€è¿œç¨‹é‡å¯ã€è¿œç¨‹å‘½ä»¤ï¼‰ã€è¯¾å ‚äº’åŠ¨ï¼ˆé¥æ§ç›‘çœ‹ã€å‡»é¼“ä¼ èŠ±ã€ç”µå­æŠ¢ç­”ã€è¯­éŸ³è¿éº¦ï¼‰ã€å›ºå®šä½ç½®ä¸Šæœºï¼ˆå›ºå®šä½ç½®ä¸Šæœºã€ç­çº§åº§ä½ç®¡ç†ï¼‰ã€äº‘æ•™å®¤ä¸Šä¸‹è¯¾

## æ‚¬æµ®å·¥å…·æ 

æ‚¬æµ®å·¥å…·æ ï¼Œæ˜¯ç‹¬ç«‹äºä¸»çª—ä½“ä¹‹å¤–çš„å¦å¤–ä¸€ä¸ªçª—å£ã€‚åªä¸è¿‡ä¸æ˜¯é»˜è®¤çš„é¡µé¢ï¼Œè€Œæ˜¯ vue å»ºç«‹çš„å¤šé¡µé¢ï¼Œä½¿ç”¨ electron å±•ç°å‡ºä¸åŒçš„çª—ä½“ã€‚å³é€šè¿‡ new BrowserWindow åˆ›å»ºçš„æŒ‡å®šçª—å£

è¯¥å·¥å…·æ å…±æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼šçª—å£å¹¿æ’­ã€åŒºåŸŸå¹¿æ’­ã€å®æ—¶è¯­éŸ³ã€å±å¹•ç¬”ã€ç¬”è®°æˆªå±ã€å•å±æ§åˆ¶ã€å…¨ä½“æ§åˆ¶ã€è‡ªåŠ¨è½®è®­ã€ä¸Šä¸€é¡µã€ä¸‹ä¸€é¡µã€ç›‘çœ‹è®¾ç½®ã€é€€å‡ºã€æ”¶èµ·ã€å›ºå®š

åŠŸèƒ½æ ¹æ®ä¸åŒçš„å…¥å£å±•ç¤ºä¸åŒçš„ç»„åˆã€‚

## å¼¹çª—

å¼¹çª—ï¼Œåœ¨å¤šåª’ä½“é¡¹ç›®ä¸­åˆ†ä¸ºä¸¤ç§å¼¹çª—ï¼Œä¸€ç§ä¼šå½±å“åˆ°ä¸»çª—ä½“(elementui çš„å¼¹çª—)ï¼Œä¸€ç§ä¸ä¼šå½±å“åˆ°ï¼ˆelectron çš„æ–°çª—ä½“ï¼‰ã€‚å³ä¸€ç§æ˜¯ element-ui è‡ªå¸¦çš„ï¼Œå¸¦æœ‰é®ç½©ä¸”åœ¨ä¸»çª—ä½“é‡Œé¢çš„ dialogï¼›å¦å¤–ä¸€ç§æ˜¯å’Œæ‚¬æµ®å·¥å…·æ ä¸€æ ·å¼¹çª—ï¼Œæ˜¯å¯ä»¥ç¼©å°åˆ°ä»»åŠ¡æ çš„ï¼Œä½¿ç”¨ new BrowserWindow åˆ›å»ºçš„æŒ‡å®šçª—å£ã€‚

ä½¿ç”¨ new BrowserWindow åˆ›å»ºçš„æŒ‡å®šçª—å£ï¼šè®¾ç½®ã€å…³äºã€ç›‘çœ‹è®¾ç½®ã€åŒºåŸŸå¹¿æ’­ã€æ¿€æ´»ã€ä¸‹å‘ä½œä¸šã€è¿œç¨‹å‘½ä»¤ã€é€€å‡ºã€åœ¨çº¿å®¢æœã€å‡»é¼“ä¼ èŠ±ã€ç”µå­æŠ¢ç­”

æ•™å¸ˆç«¯ç›®å½•

```
â”œâ”€api // äºŒæ¬¡å°è£…çš„ axios è¯·æ±‚
â”œâ”€assets
â”‚ â”œâ”€css // å…¬å…± css æ ·å¼
â”‚ â””â”€img // å›¾ç‰‡èµ„æº
â”œâ”€components // ç»„ä»¶ï¼ˆç™»å½•å¤´éƒ¨èœå•ã€ä¸»é¡µé¢å¤´éƒ¨èœå•ï¼‰
â”œâ”€mixins // å¯æ‹–æ‹½å¼¹çª—å¤´éƒ¨èœå•å…¬å…± mixin
â”œâ”€router // è·¯ç”±
â”œâ”€store // vuex
â”œâ”€utils // å…¬å…±æ–¹æ³•
â””â”€views
â”œâ”€home // ä¸»é¡µé¢å…¥å£
â”‚ Home.vue
â”œâ”€login // ç™»å½•é¡µé¢å…¥å£
â”‚ Login.vue
â””â”€viewTop // æ‚¬æµ®å·¥å…·æ å…¥å£
MonitorSet.vue
ViewTop.vue
```

# è‡ªæµ‹è”è°ƒç­‰ç›¸å…³ä¿¡æ¯

## æµ‹è¯•ç¯å¢ƒ

* åœ°å€ï¼š172.16.228.5

## build æµç¨‹

> smb è´¦å·ï¼šdmt å¯†ç ï¼š123456

1. `yarn build` â€”â€” teacher-ui å’Œ common-electronã€‚

1. `cd packages\common-electron\; robocopy.exe .\dist\linux-unpacked\resources \\172.20.4.46\06æµ‹è¯•å…±äº«\xufan app.asar /xo` å°†æ‰“åŒ…äº§ç‰©å‘å¸ƒåˆ°å…±äº« smb æœåŠ¡å™¨ä¸Šã€‚

1. å‰©ä¸‹çš„ç¼–è¯‘äº§ç‰©å¯ä»¥æäº¤åˆ° gitï¼Œä½†æ ¹æ®ç½—å‡¯è¯´çš„å®é™…ä¸Šæ²¡æœ‰ç”¨å¤„ï¼Œä¹Ÿå¯ä»¥ä¸æäº¤ã€‚

![](./files/1704786122058.å¤šåª’ä½“.md.png)

### å…³äºæ¶æ„å·®å¼‚

å¦‚æœåªç»™ *app.asar* çš„è¯ï¼Œæ²¡æœ‰ä»»ä½•å·®å¼‚ï¼š

```
ğŸªŸ ğŸ•™[ 15:35:07 ] electron-mmc\packages\common-electron on î‚  2.1.0 [âœ˜!?â‡¡1] via îœ˜ v16.20.0 using ğŸ 72%
PS â¯ Get-FileHash .\dist\linux-unpacked\resources\app.asar

Algorithm       Hash                                                                   Path
---------       ----                                                                   ----
SHA256          51E2CEDD1067F88062D97FDF86729BCD45F6211C5D966A9CCE697E27B7102BCB       X:\working\electron-mmc\paâ€¦

ğŸªŸ ğŸ•™[ 15:47:13 ] electron-mmc\packages\common-electron on î‚  2.1.0 [âœ˜!?â‡¡1] via îœ˜ v16.20.0 using ğŸ 73%
PS â¯ Get-FileHash .\dist\linux-arm64-unpacked\resources\app.asar

Algorithm       Hash                                                                   Path
---------       ----                                                                   ----
SHA256          51E2CEDD1067F88062D97FDF86729BCD45F6211C5D966A9CCE697E27B7102BCB       X:\working\electron-mmc\paâ€¦
```