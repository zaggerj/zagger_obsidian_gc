---
created: 2023-11-03T22:29
updated: 2023-11-07T10:54
---
[TOC]

> 撰写人：黄子杰
> 撰写时间：2023-04-18 10:12:19 周一


# 参考文档
[前端代码管理与提交规范--ShowDoc](http://192.168.0.161:4999/web/#/3/4394)
# 前端代码管理与提交规范
1. [分支管理规范](#分支管理规范)
2. [Merge Request提交规范](#MergeRequest提交规范)
3. [代码审查标准](#代码审查标准)


## <span id=分支管理规范>一、分支管理规范</span>

### 仓库管理员（maintainer）


仓库管理员职责：


- 维护代码仓库：
	- 负责每个版本三大分支的创建：**主干分支**、**公共开发分支**、**解bug分支**。
	- 负责每个版本三大分支之间的合并与冲突解决：
		1. 要求仓库管理员每天将**解bug分支**合并一次到**公共开发分支**。
		2. 打包前，根据需要进行三大分支合并（具体合并方式，见后面的“新功能转测”和“分迭代交付测试”说明）。
	- 版本发布后，及时打 tag。
	- 版本发布后，临时分支的清理。
	- 保证分支命名符合规范，在仓库 Wiki 里维护分支用途说明。

- 审查、合并代码：
	- 每天17:00之前的合并请求必须当天处理完。若是当天需要打包，那么所有合并请求要在打包前处理完毕（包含整改）。
	- 每次审查代码时，需要将其中问题按照问题分类进行备注，方便生成审查报告。
	- 每次的审查报告，目前通过后端脚本统一输出，最终给到QA这边进行统计。
	- 审查代码时，pre-commit 检查是否通过也在审查范围内。

- 代码审查报告：
	- 一个 MR 只需发送一次报告（可以在 MR 合并后发报告）。
	- 报告中要包含这次 MR 中发现的所有问题。
	- 评价是对这次 MR 的整体评价。



### 开发阶段


- 主干分支：每个版本基于上一个版本创建一个**主干分支**，各版本主干分支命名规范如下：

	1. 教育版：     `x.x.x-dev`，例如：5.5.0-dev
	2. 	 政企版(x86)：`x.x.x-vpc`，例如：5.3.3-vpc
	3. 	 政企信创版（政企多架构版）：`x.x.x-vpc-arm`，例如：5.3.0-vpc-arm
	4. 	 其他衍生版本：在上述名称后面继续添加 `-xxx` 后缀（**对于教育版的衍生版本，省略-dev**），比如教育版docker版`x.x.x-docker`，政企版(x86)docker版 `x.x.x-vpc-docker`

- 公共开发分支：基于版本主干分支切出**公共开发分支**，添加后缀 `-feature`，比如教育版5.4.0的开发分支 5.4.0-feature。

	1. 开发人员基于**公共开发分支**切出自己的**本地开发分支**，比如 5.4.0-feature-ipv6.
	2. 	 所有新功能开发最终都合并到**公共开发分支**上。
	3. 	 合并完代码之后，注意先本地检查各个**本地开发分支**所涉及到的功能是否都存在于**公共开发分支**上，保证功能完整。


### 新功能转测


1. 仓库管理员将**公共开发分支**合并到版本**主干分支**上（例如：x.x.x-feature => x.x.x-dev），
2. 如果有**解bug分支**，也需要合并到版本**主干分支**上（例如：x.x.x-bug => x.x.x-dev）。
3. 然后，将**主干分支**合并回**公共开发分支**和**解bug分支**，保证这三个分支代码一致。
4. 最后，通知打包者对**主干分支**进行打包。



### 测试阶段


1. 解bug分支：进入测试后，或者有上个版本遗留bug，就需要添加**解bug分支**，后缀是 `-bug`，比如：5.4.0-bug，5.3.0-vpc-bug；

**注意：**
- 开发人员在接收到bug后，修改代码并提交到**解bug分支**；
- 仓库管理员**每天**将**解bug分支**合并一次到**公共开发分支**（例如：x.x.x-bug => x.x.x-feature）。


### 分迭代交付测试


如果版本中存在分迭代交付测试的情况，比如，第一迭代已转测，第二迭代开发中。


1. 那么，第二迭代的开发提交到**公共开发分支**，
2. 同时第一迭代的bug修复在**解bug分支**上进行，
3. 第一迭代打包时，只将**解bug分支**合并到**主干分支**上进行打包。
4. 当第二迭代开发完毕并自测通过后，再将**公共开发分支**合并到**主干分支**。

**注意：**
- **公共开发分支**总是领先于**主干分支**，如果存在多迭代开发，两个迭代并存时，可以将**公共开发分支**视为最新迭代分支，**主干分支**为次新迭代分支。此时，**解bug分支**为**主干分支**的对应bug分支。

### 发布后


版本发布后，


1. 由仓库管理员给各仓库打tag，tag名称格式为 `版本-release`，例如，教育版5.4.0发布后需要打tag `5.4.0-release`，VPC 5.3.3 发布后需要打 tag `5.3.3-vpc-release`.
2. 注意保证打tag的commit与发布版一致。


### 其他分支


- 定制开发：分支名是在基于的主干分支名后添加 `-custom-xxx` 后缀（**对于教育版定制版，省略-dev**），xxx是定制版本的名称简写。
- 制作补丁：
  - 通用补丁：分支名是在基于的主干分支名后添加 `-patch-xxx` 后缀（**对于教育版补丁，省略-dev**），xxx是补丁功能的英文简写。
  - 项目型补丁：分支名是在基于的主干分支名后添加 `-patch-prj-xxx` 后缀（**对于教育版补丁，省略-dev**），xxx是补丁功能的英文简写。
- 补丁主分支：基于主版本建立`xxx-patch`，例如主版本为`5.5.1-dev`，**补丁主分支**为`5.5.1-patch`，需要包含和集成当前版本的所有通用补丁，将当前版本的所有`xxx-patch-`开头的分支全部合并到`5.5.1-patch`分支中来，并包含补丁说明文件，说明**补丁主分支**包含补丁的范围。


**注意：开发者要将分支用途的详细说明更新到仓库Wiki里。**


## <span id=MergeRequest提交规范>二、Merge Request提交规范</span>


### Merge Request模式
引入 Merge Request 模式的目的是：将代码审查提前，及时发现问题，保证代码质量。

相比较传统的分支管理模式，Merge Request可以给我们带来下面几个好处：


1. 重要分支设置为受保护，杜绝了有些问题代码在不知情的情况下被提交了；
2. 每个任务都有一个对应的分支，互相隔离，所有的代码改动有据可查；
3. 开发人员不用在分支间切换和合并，更专注于开发。



### Merge Request开发流程


1. 在**公共开发分支**或者**解bug分支**拉出新的分支
2. 在新的分支上编写代码
3. 推送修改代码到远程同名分支
4. 在 GitLab 创建Merge Request
5. 管理员审核代码与Merge代码



### 步骤截图
1. 首先，在合并请求中，点击【New merge request】按钮新建MR
![](http://192.168.0.161:4999/server/index.php?s=/api/attachment/visitFile&sign=df2d81e93e49975bf0f42260a6ff5089)
2. 选择好源分支和目标分支，然后点击【Compare branches and continue】
![](http://192.168.0.161:4999/server/index.php?s=/api/attachment/visitFile&sign=93952add6866d9b2749359acb0f9f69a)
3. 填写MR的标题、指派人、审核者字段，设置合并选项为删除源分支，点击【Submit 合并请求】，提交MR![](http://192.168.0.161:4999/server/index.php?s=/api/attachment/visitFile&sign=b60a478e3f32277ac1b6879284140c14)
4. 审核者收到合并请求的邮件，在合并请求列表中查看到MR，点击MR，查看提交和变更，针对代码进行评审![](http://192.168.0.161:4999/server/index.php?s=/api/attachment/visitFile&sign=0c0cdc9802b96054ed0cefad7d1c3fcc)

### 注意事项

如果当前分支与目标分支存在冲突（conflict），是不能够与目标分支进行合并。所以在准备提交之前，如果当前分支出现冲突，请根据情况把当前分支与目标分支先(rebase/merge)，在本地解决冲突。因为只有代码作者本人才熟悉代码逻辑结构，解决冲突的责任应由开发者本人操作。


## <span id=代码审查标准>三、代码审查标准</span>

**代码审查标准：**


- 不合格：
	1.发现明显逻辑问题；
	2.存在需求实现方案缺陷；
	3.明显语法错误；
	4.存在一个1个严重问题。
- 合格：
	1.未发现明显问题；
	2.普通问题不超过3个。
- 良好：
	1.代码量必须大于100行以上。
	2.无严重问题。
	3.逻辑清晰。
	4.注释明确。
	5.封装良好。
	6.浏览器端代码要求代码风格统一；服务端（nodejs代码）要求日志丰富。
- 优秀：
	1.代码量大于100行以上。
	2.设计和封装优秀。
	3.代码简洁程度高，易读，异常和异常逻辑处理合理。
	4.对于性能和稳定性考虑周全，可作为标杆。


**问题分类标准**:


|问题分类|说明|级别|
| ----------------| ------------------------------------------------------------| -------|
|界面样式问题|界面布局错乱、样式风格不统一，界面显示问题等|一般|
|代码优化|没有上面的严重问题，但明显存在更简洁更优的写法或者方案，或者存在其他违反代码可重用性、可维护性问题|一般|
|风格规范|代码不符合规范，代码没有通过pre-commit检查，存在代码风格检查以外的问题，存在变量名太随意、魔鬼数字等问题|一般|
|冗余代码|没用到的代码，永远走不到的代码，多此一举的代码，可优化的代码|一般|
|缺少日志或注释|关键处缺少日志，不便于排错；复杂逻辑缺少注释，不便于理解；|一般|
|交互问题|存在明显交互不顺畅，交互异常，页面跳转，弹窗打开关闭等问题|普通|
|代码文字错误|代码中的文字错误，比如名词错误等|普通|
|多语言支持|未考虑多语言支持，或者多语言支持无效|普通|
|需求实现|需求未实现，或者实现不正确（理解有误等）|普通|
|异常处理|缺少异常处理，但是不会造成程序崩溃|普通|
|语法错误|编程语言有语法错误|严重|
|逻辑错误|逻辑不正确|严重|
|安全漏洞|易受攻击，造成数据丢失，造成程序崩溃等|严重|
|性能问题|影响性能或者稳定性|严重|



其他未归类问题，参照以下标准【手动裁定】严重级别：


- 严重：导致程序报错、崩溃、数据丢失、交互阻塞、操作异常等严重后果。
- 普通：不会导致上述严重后果，但是会产生bug。
- 一般：不会产生bug，但是影响代码维护、阅读、理解、排错等。

## 参考文档


1. [代码管理与提交规范](http://192.168.0.161:4999/web/#/3/2709)

